!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var i=window.webpackJsonpTexteditor;window.webpackJsonpTexteditor=function(t,n,s){for(var r,a,l=0,d=[];l<t.length;l++)a=t[l],o[a]&&d.push(o[a][0]),o[a]=0;for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);for(i&&i(t,n,s);d.length;)d.shift()()};var n={},o={30:0};t.e=function(e){function i(){a.onerror=a.onload=null,clearTimeout(l);var t=o[e];0!==t&&(t&&t[1](new Error("Loading chunk "+e+" failed.")),o[e]=void 0)}var n=o[e];if(0===n)return new Promise(function(e){e()});if(n)return n[2];var s=new Promise(function(t,i){n=o[e]=[t,i]});n[2]=s;var r=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript",a.charset="utf-8",a.async=!0,a.timeout=12e4,t.nc&&a.setAttribute("nonce",t.nc),a.src=t.p+""+({1:"markdown-mode",2:"php-mode",3:"html-mode",4:"svg-mode",5:"xml-mode",6:"scala-mode",7:"lua-mode",8:"json-mode",9:"js-mode",10:"java-mode",11:"groovy-mode",12:"css-mode",13:"coffee-mode",14:"ace",15:"textile-mode",16:"sql-mode",17:"sh-mode",18:"scss-mode",19:"scad-mode",20:"rb-mode",21:"py-mode",22:"ps1-mode",23:"pl-mode",24:"ml-mode",25:"less-mode",26:"latex-mode",27:"cs-mode",28:"h-mode",29:"bat-mode"}[e]||e)+".bundle.js";var l=setTimeout(i,12e4);return a.onerror=a.onload=i,r.appendChild(a),s},t.m=e,t.c=n,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t.oe=function(e){throw console.error(e),e},t(t.s="./js/index.js")}({"./js/ImportAce.js":function(e,t,i){"use strict";/*
 * @copyright Copyright (c) 2019 Julius Härtl <jus@bitgrid.net>
 *
 * @author Julius Härtl <jus@bitgrid.net>
 *
 * @license GNU AGPL version 3 or any later version
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 *
 */
t.a=function(){return i.e(14).then(i.bind(null,"./node_modules/brace/index.js"))}},"./js/SyntaxMode.js":function(e,t,i){"use strict";function n(e){var t=o[e];return t?s[t]().then(function(){return t}):$.when()}t.a=n;var o={};o.bat="batchfile",o.cmd="batchfile",o.h="c_cpp",o.c="c_cpp",o.clj="clojure",o.coffee="coffee",o.cpp="c_cpp",o.cs="csharp",o.css="css",o.groovy="groovy",o.htm="html",o.html="html",o.tt="html",o.java="java",o.js="javascript",o.jsm="javascript",o.json="json",o.latex="latex",o.tex="latex",o.less="less",o.ly="latex",o.ily="latex",o.lua="lua",o.markdown="markdown",o.md="markdown",o.mdown="markdown",o.mdwn="markdown",o.mkd="markdown",o.ml="ocaml",o.mli="ocaml",o.pl="perl",o.php="php",o.ps1="powershell",o.py="python",o.rb="ruby",o.scad="scad",o.scala="scala",o.scss="scss",o.sh="sh",o.sql="sql",o.svg="svg",o.textile="textile",o.xml="xml";var s={};s.batchfile=function(){return i.e(29).then(i.bind(null,"./node_modules/brace/mode/batchfile.js"))},s.c_cpp=function(){return i.e(28).then(i.bind(null,"./node_modules/brace/mode/c_cpp.js"))},s.coffee=function(){return i.e(13).then(i.bind(null,"./node_modules/brace/mode/coffee.js"))},s.cs=function(){return i.e(27).then(i.bind(null,"./node_modules/brace/mode/csharp.js"))},s.css=function(){return i.e(12).then(i.bind(null,"./node_modules/brace/mode/css.js"))},s.groovy=function(){return i.e(11).then(i.bind(null,"./node_modules/brace/mode/groovy.js"))},s.html=function(){return i.e(3).then(i.bind(null,"./node_modules/brace/mode/html.js"))},s.java=function(){return i.e(10).then(i.bind(null,"./node_modules/brace/mode/java.js"))},s.javascript=function(){return i.e(9).then(i.bind(null,"./node_modules/brace/mode/javascript.js"))},s.json=function(){return i.e(8).then(i.bind(null,"./node_modules/brace/mode/json.js"))},s.latex=function(){return i.e(26).then(i.bind(null,"./node_modules/brace/mode/latex.js"))},s.less=function(){return i.e(25).then(i.bind(null,"./node_modules/brace/mode/less.js"))},s.lua=function(){return i.e(7).then(i.bind(null,"./node_modules/brace/mode/lua.js"))},s.markdown=function(){return i.e(1).then(i.bind(null,"./node_modules/brace/mode/markdown.js"))},s.ocaml=function(){return i.e(24).then(i.bind(null,"./node_modules/brace/mode/ocaml.js"))},s.perl=function(){return i.e(23).then(i.bind(null,"./node_modules/brace/mode/perl.js"))},s.php=function(){return i.e(2).then(i.bind(null,"./node_modules/brace/mode/php.js"))},s.powershell=function(){return i.e(22).then(i.bind(null,"./node_modules/brace/mode/powershell.js"))},s.python=function(){return i.e(21).then(i.bind(null,"./node_modules/brace/mode/python.js"))},s.ruby=function(){return i.e(20).then(i.bind(null,"./node_modules/brace/mode/ruby.js"))},s.scad=function(){return i.e(19).then(i.bind(null,"./node_modules/brace/mode/scad.js"))},s.scala=function(){return i.e(6).then(i.bind(null,"./node_modules/brace/mode/scala.js"))},s.scss=function(){return i.e(18).then(i.bind(null,"./node_modules/brace/mode/scss.js"))},s.sh=function(){return i.e(17).then(i.bind(null,"./node_modules/brace/mode/sh.js"))},s.sql=function(){return i.e(16).then(i.bind(null,"./node_modules/brace/mode/sql.js"))},s.svg=function(){return i.e(4).then(i.bind(null,"./node_modules/brace/mode/svg.js"))},s.textile=function(){return i.e(15).then(i.bind(null,"./node_modules/brace/mode/textile.js"))},s.xml=function(){return i.e(5).then(i.bind(null,"./node_modules/brace/mode/xml.js"))}},"./js/editor.js":function(e,i,n){"use strict";n.d(i,"a",function(){return l});var o=n("./js/SyntaxMode.js"),s=n("./js/ImportAce.js"),r=n("./js/supported_mimetypes.json"),a=void 0,l={$container:null,editor:"editor",file:{edited:!1,mtime:null,dir:null,name:null,writeable:null,mime:null,size:null},saving:!1,currentContext:null,saveTimer:null,oldTitle:null,saveMessageTimeout:null,previewPlugins:{},registerPreviewPlugin:function(e,t){this.previewPlugins[e]=t},previewPluginsLoaded:{},preview:null,previewPluginOnChange:null,_onSaveTrigger:function(){if(l.file.edited&&!l.saving){l.saving=!0,l.file.edited=!1,clearTimeout(l.saveMessageTimeout);var e=$("#editor_controls").find("small.saving-message");e.text(t("files_texteditor","saving...")).show(),l.saveFile(window.aceEditor.getSession().getValue(),l.file,function(i){0==l.file.edited&&(document.title=l.file.name+" - "+l.oldTitle,$("small.unsaved-star").css("display","none")),l.file.mtime=i.mtime,l.file.size=i.size,e.text(t("files_texteditor","saved!")),l.saveMessageTimeout=setTimeout(function(){$("small.saving-message").fadeOut(200)},2e3)},function(e){void 0===e?$("small.saving-message").text(t("files_texteditor","failed!")):$("small.saving-message").text(e),l.saveMessageTimeout=setTimeout(function(){$("small.saving-message").fadeOut(200)},5e3),l.file.edited=!0}),l.saving=!1,window.aceEditor.focus()}},_onCloseTrigger:function(){l.file.edited?(l.file.edited=!1,l.hideEditor(),l.saveFile(window.aceEditor.getSession().getValue(),l.file,function(){OC.Notification.showTemporary(t("files_texteditor","Saved")),l.closeEditor()},function(){OC.Notification.showTemporary(t("files_texteditor","There was a problem saving your changes. Click to resume editing.")),$("#notification").data("reopeneditor",!0).on("click",l._onReOpenTrigger),l.file.edited=!0})):l.closeEditor()},_onReOpenTrigger:function(){1==$("#notification").data("reopeneditor")&&(document.title=l.file.name+" - "+l.oldTitle,l.$container.show())},_onEditorTrigger:function(e,t){var i=this;this.currentContext=t,this.file.name=e,this.file.dir=t.dir,this.fileList=t.fileList,Object(s.a)().then(function(n){a=n,i.loadEditor(l.$container,l.file),history.pushState({file:e,dir:t.dir},"Editor","#editor")})},_onEdit:function(){if(l.file.edited||(l.file.edited=!0,l.saving||l._onUnsaved()),this.previewPluginOnChange){var e=window.aceEditor.getSession().getValue();this.previewPluginOnChange(e,this.preview)}},_onUnsaved:function(){document.title="* "+l.file.name+" - "+l.oldTitle,$("small.unsaved-star").css("display","inline-block")},initialize:function(e){$("#content.app-files").length&&(this.$container=e,this.registerFileActions(),this.oldTitle=document.title)},registerFileActions:function(){var e=this;r.forEach(function(t){OCA.Files.fileActions.registerAction({name:"Edit",mime:t,actionHandler:e._onEditorTrigger.bind(e),permissions:OC.PERMISSION_READ,icon:function(){return OC.imagePath("core","actions/edit")}}),OCA.Files.fileActions.setDefault(t,"Edit")})},loadEditor:function(e,i){var n=this;e.html('<div id="editor_overlay"></div><div id="editor_container" class="icon-loading"><div id="editor_wrap"><div id="editor"></div><div id="preview_wrap"><div id="preview"></div></div></div></div>'),$("#content").append(e),this.loadFile(i.dir,i.name,function(t,i){if(document.title=t.name+" - "+l.oldTitle,$("#"+n.editor).text(i),$("#editor_container").removeClass("icon-loading"),n.configureACE(t),n.loadControlBar(t),window.aceEditor.getSession().on("change",n.setupAutosave),n.bindVisibleActions(),window.aceEditor.focus(),n.previewPlugins[t.mime]){n.preview=e.find("#preview"),n.preview.addClass(t.mime.replace("/","-")),e.find("#editor_container").addClass("hasPreview"),n.previewPluginOnChange=_.debounce(function(e,i){n.loadPreviewPlugin(t.mime).then(function(){n.previewPlugins[t.mime].preview(e,i)})},200);var o=window.aceEditor.getSession().getValue();n.previewPluginOnChange(o,n.preview),setTimeout(function(){window.aceEditor.resize()},500),n.loadPreviewControlBar()}else n.previewPluginOnChange=null},function(e){OC.dialogs.alert(e,t("files_texteditor","An error occurred!")),n.closeEditor()})},loadPreviewPlugin:function(e){if(this.previewPluginsLoaded[e])return $.Deferred().resolve().promise();this.previewPluginsLoaded[e]=!0;var t=this.previewPlugins[e];return $.when(t.init())},loadControlBar:function(e){var t='<small class="filename">'+escapeHTML(e.name)+'</small><small class="unsaved-star" style="display: none">*</small><small class="saving-message"></small><button id="editor_close" class="icon-close svg"></button>',i=$('<div id="editor_controls"></div>').html(t);$("#editor_wrap").before(i),this.setFilenameMaxLength(),this.bindControlBar()},setPreviewMode:function(e){var t=$("#app-content-texteditor"),i=$("#preview_editor_controls");switch(i.find("button").removeClass("active"),i.find('button[data-type="'+e+'"]').addClass("active"),e){case"mixed":t.find("#editor_container").addClass("hasPreview"),t.find("#editor_container").removeClass("onlyPreview");break;case"text":t.find("#editor_container").removeClass("hasPreview"),t.find("#editor_container").removeClass("onlyPreview");break;case"image":t.find("#editor_container").addClass("hasPreview"),t.find("#editor_container").addClass("onlyPreview")}setTimeout(function(){window.aceEditor.resize()},500)},loadPreviewControlBar:function(){var e=function(e,t,i){var n=$("<button/>");return n.tooltip({title:t,container:"body",placement:"bottom",delay:{show:500,hide:0}}),i&&n.addClass("active"),n.click(this.setPreviewMode.bind(this,e)),n.attr("data-type",e),n.css("background-image",'url("'+OC.imagePath("files_texteditor",e)+'")')}.bind(this),i=$("<span/>").attr("id","preview_editor_controls");i.append(e("text",t("files_texteditor","Edit"))),i.append(e("mixed",t("files_texteditor","Mixed"),!0)),i.append(e("image",t("files_texteditor","Preview"))),$("#editor_close").after(i)},unloadControlBar:function(){$("#editor_controls").remove()},setFilenameMaxLength:function(){var e=$("#editor_controls").width(),t=$("small.saving-message").outerWidth(!0);t+=$("small.unsaved-star").outerWidth(!0),t+=$("#editor_close").outerWidth(!0),$("small.filename").css("max-width",e-t-28)},bindControlBar:function(){$("#editor_close").on("click",_.bind(this._onCloseTrigger,this)),$(window).resize(l.setFilenameMaxLength),window.onpopstate=function(){"editor"!==location.hash.substr(1).substr(0,6)&&this._onCloseTrigger()}.bind(this)},configureACE:function(e){window.aceEditor=a.edit(this.editor),aceEditor.getSession().setNewLineMode("windows"),aceEditor.setShowPrintMargin(!1),aceEditor.getSession().setUseWrapMode(!0),e.writeable||aceEditor.setReadOnly(!0),e.mime&&"text/html"===e.mime?this.setEditorSyntaxMode("html"):this.setEditorSyntaxMode(e.name.split(".")[e.name.split(".").length-1]),n.e(0).then(n.bind(null,"./node_modules/brace/theme/clouds.js")).then(function(){window.aceEditor.setTheme("ace/theme/clouds")}),window.aceEditor.getSession().on("change",this._onEdit.bind(this)),window.aceEditor.commands.addCommand({name:"save",bindKey:{win:"Ctrl-S",mac:"Command-S",sender:"editor"},exec:l._onSaveTrigger}),window.aceEditor.commands.removeCommand(window.aceEditor.commands.byName.transposeletters)},setEditorSyntaxMode:function(e){Object(o.a)(e).then(function(e){e&&window.aceEditor.getSession().setMode("ace/mode/"+e)})},loadFile:function(e,t,i,n){$.get(OC.generateUrl("/apps/files_texteditor/ajax/loadfile"),{filename:t,dir:e}).done(function(e){l.file.writeable=e.writeable,l.file.mime=e.mime,l.file.mtime=e.mtime,i(l.file,e.filecontents)}).fail(function(e){n(JSON.parse(e.responseText).message)})},saveFile:function(e,t,i,n){var o=t.dir+t.name;"/"!==t.dir&&(o=t.dir+"/"+t.name),$.ajax({type:"PUT",url:OC.generateUrl("/apps/files_texteditor/ajax/savefile"),data:{filecontents:e,path:o,mtime:t.mtime}}).done(i).fail(function(e){var t;try{t=JSON.parse(e.responseText).message}catch(e){}n(t)})},closeEditor:function(){this.$container.html("").show(),this.unloadControlBar(),this.unBindVisibleActions();var e=this.fileList.getModelForFile(this.file.name);e&&e.set({etag:e.get("id")+this.file.mtime,mtime:1e3*this.file.mtime,size:this.file.size}),document.title=this.oldTitle},hideEditor:function(){this.$container.hide(),document.title=this.oldTitle,this.unBindVisibleActions()},setupAutosave:function(){clearTimeout(this.saveTimer),this.saveTimer=setTimeout(l._onSaveTrigger,3e3)},_onClickDocument:function(e){$(e.target).closest("#editor_container").length||$(e.target).closest(".oc-dialog").length||l._onCloseTrigger()},bindVisibleActions:function(){$(document).bind("click",this._onClickDocument)},unBindVisibleActions:function(){$(document).unbind("click",this._onClickDocument)}}},"./js/index.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("./js/sidebarpreview.js"),o=i("./js/editor.js"),s=i("./js/newfileplugin.js");i.p=OC.filePath("files_texteditor","js","../build/");var r=document.querySelector("[nonce]");i.nc=r.nonce||r.getAttribute("nonce"),OCA.Files_Texteditor=o.a,OC.Plugins.register("OCA.Files.NewFileMenu",s.a),OC.Plugins.register("OCA.Files.SidebarPreviewManager",new n.a),$(document).ready(function(){$("#editor").remove(),OCA.Files_Texteditor.initialize($('<div id="app-content-texteditor"></div>'))})},"./js/newfileplugin.js":function(e,i,n){"use strict";n.d(i,"a",function(){return o});var o={attach:function(e){var i=e.fileList;"files"===i.id&&e.addMenuEntry({id:"file",displayName:t("files_texteditor","New text file"),templateName:t("files_texteditor","New text file.txt"),iconClass:"icon-filetype-text",fileType:"file",actionHandler:function(e){var t=i.getCurrentDirectory();i.createFile(e).then(function(){OCA.Files_Texteditor._onEditorTrigger(e,{fileList:i,dir:t})})}})}}},"./js/sidebarpreview.js":function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i.d(t,"a",function(){return l});var o=i("./js/SyntaxMode.js"),s=i("./js/ImportAce.js"),r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i("./js/supported_mimetypes.json"),l=function(){function e(){n(this,e)}return r(e,[{key:"attach",value:function(e){var t=this.handlePreview.bind(this);a.forEach(function(i){return e.addPreviewHandler(i,t)})}},{key:"handlePreview",value:function(e,t,n,r){var a=n.parent().width()+50,l=a/(16/9);this.getFileContent(e.getFullPath()).then(function(r){r=r.filecontents,t.removeClass("icon-loading icon-32"),n.addClass("large"),n.addClass("text");var d=$("<div id='sidebar_editor'/>");d.text(r),t.children(".stretcher").remove(),t.append(d),Object(s.a)().then(function(t){var n=t.edit("sidebar_editor");n.setReadOnly(!0);var s=void 0;s="text/html"===e.get("mimetype")?Object(o.a)("html"):Object(o.a)(e.get("name").split(".")[e.get("name").split(".").length-1]),s.then(function(e){e&&n.getSession().setMode("ace/mode/"+e)}),i.e(0).then(i.bind(null,"./node_modules/brace/theme/clouds.js")).then(function(){n.setTheme("ace/theme/clouds")}),d.css("height",l),d.css("width",a)})},function(){r()})}},{key:"getFileContent",value:function(e){var t=e.split("/"),i=t.slice(0,-1).join(""),n=t.slice(-1).join("");return $.ajax({url:OC.generateUrl("/apps/files_texteditor/ajax/loadfile"),data:{filename:n,dir:i},headers:{Range:"bytes=0-10240"}})}}]),e}()},"./js/supported_mimetypes.json":function(e,t){e.exports=["text","application/cmd","application/javascript","application/json","application/xml","application/x-empty","application/x-msdos-program","application/x-php","application/x-pearl","application/x-text","application/yaml"]}});
//# sourceMappingURL=editor.js.map